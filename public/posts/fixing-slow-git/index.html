<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Solving Slow Git Repos | Nick Herrig</title>
<meta name="keywords" content="web">
<meta name="description" content="Experiments with fixing my slow github repo cloning/pulling with image resizing.">
<meta name="author" content="Me">
<link rel="canonical" href="http://localhost:1313/posts/fixing-slow-git/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/fixing-slow-git/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Nick Herrig (Alt + H)">Nick Herrig</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://resume.nickherrig.com" title="Resume">
                    <span>Resume</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Solving Slow Git Repos
    </h1>
    <div class="post-description">
      Experiments with fixing my slow github repo cloning/pulling with image resizing.
    </div>
    <div class="post-meta"><span title='2024-02-11 00:00:00 +0000 UTC'>February 11, 2024</span>&nbsp;Â·&nbsp;Me&nbsp;|&nbsp;<a href="https://github.com/NickHerrig/nickherrig.com/tree/master/content/posts/fixing-slow-git.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#image-resizing-and-formating" aria-label="Image Resizing and Formating">Image Resizing and Formating</a></li>
                <li>
                    <a href="#the-numbers" aria-label="The Numbers">The Numbers</a></li>
                <li>
                    <a href="#git-lfs" aria-label="Git LFS">Git LFS</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>I was in the process of cloning the code for this website from github on a new laptop when I noticed something.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git clone git@github.com:NickHerrig/nickherrig.com.git
</span></span></code></pre></div><p>The repo was taking a noticable amount of time to clone.
I timed how long it took and found that it was about 8.5 seconds!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Cloning into <span style="color:#e6db74">&#39;nickherrig.com&#39;</span>...
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 583, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>76/76<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>50/50<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">583</span> <span style="color:#f92672">(</span>delta 23<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">72</span> <span style="color:#f92672">(</span>delta 22<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">507</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>583/583<span style="color:#f92672">)</span>, 78.74 MiB | 11.49 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>226/226<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>git clone git@github.com:NickHerrig/nickherrig.com.git  1.08s user 1.94s system 35% cpu 8.524 total
</span></span></code></pre></div><p>I had a gut feel it was related to the images that I&rsquo;m storing in the repo, but I wanted to make sure.
To find out I ran a <code>du -sh *</code> to try and find the largest directory.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>du -sh *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>4.0K    README.md
</span></span><span style="display:flex;"><span>4.0K    archetypes
</span></span><span style="display:flex;"><span> 88K    content
</span></span><span style="display:flex;"><span>4.0K    hugo.yaml
</span></span><span style="display:flex;"><span> 74M    static
</span></span><span style="display:flex;"><span>  0B    themes
</span></span></code></pre></div><p>From here I noticed that my static directory was 74M. Gut feel confirmed. This is where I store all my blog images.
A little more digging showed that I was storing 26M of images from my most recent blog post <a href="https://nickherrig.com/posts/kauai-hawaii-adventures/">Kauai Hawaii - Part One: Adventures</a>. As I look forward to writing more blog posts with image content, I realized this doesn&rsquo;t really scale well with the usability of my git repo. I started doing a little research and decided to tackle this problem in two ways.</p>
<h2 id="image-resizing-and-formating">Image Resizing and Formating<a hidden class="anchor" aria-hidden="true" href="#image-resizing-and-formating">#</a></h2>
<p>When I realized my images were pretty large, I wanted to confirm this with another form of analysis. I reached for a popular tool called <a href="https://pagespeed.web.dev/">PageSpeed Insights</a>. You can use this tool to run an analysis on specific pages of a website to get a report on performance issues.</p>
<figure>
    <img loading="lazy" src="/images/pagespeed_results.png"/> <figcaption>
            pagespeed results for kauai adventures blog
        </figcaption>
</figure>

<p>One call out was to utilize next-gen formats like webp. Another call out was to properly size the images. I decided to write a quick shell script to change the form of my images fro jpg to webp and reduce the quality.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> img in *.jpg; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  magick convert <span style="color:#e6db74">&#34;</span>$img<span style="color:#e6db74">&#34;</span> -quality <span style="color:#ae81ff">80</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>img%.jpg<span style="color:#e6db74">}</span><span style="color:#e6db74">.webp&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>With that, we&rsquo;re down to 11M from 26M! Not bad! Next, I wanted to resize the images. In order to do this, I needed to first identify the current size of the images, then figure out what the computed values were on the website. To run this example, let&rsquo;s look at the caves image.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>identify -format <span style="color:#e6db74">&#34;%wx%h\n&#34;</span> caves.webp     
</span></span><span style="display:flex;"><span>4032x3024
</span></span></code></pre></div><p>When looking at the deployed production site, the same image height was 540px and width was 720px. This means we can resize to the computed value, and maybe even get away with bumping the quality to 100%. Let&rsquo;s try it out.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>du -sh caves.webp                         
</span></span><span style="display:flex;"><span>1.8M    caves.webp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>magick caves.webp -resize 720x540 -quality <span style="color:#ae81ff">100</span> _caves.webp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>du -sh caves.webp _caves.webp 
</span></span><span style="display:flex;"><span>1.8M    caves.webp
</span></span><span style="display:flex;"><span>496K    _caves.webp
</span></span></code></pre></div><p>And just lke that we&rsquo;ve saved a ton of space, and my human eyes cannot tell the difference! I&rsquo;ll spare you the repetitveness of doing this to every image in my repo for the purpose of this blog.</p>
<h2 id="the-numbers">The Numbers<a hidden class="anchor" aria-hidden="true" href="#the-numbers">#</a></h2>
<p>Now when I take a peak at my static directory here&rsquo;s what I see.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>du -sh *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>4.0K    README.md
</span></span><span style="display:flex;"><span>4.0K    archetypes
</span></span><span style="display:flex;"><span> 84K    content
</span></span><span style="display:flex;"><span>4.0K    hugo.yaml
</span></span><span style="display:flex;"><span>4.1M    static      <span style="color:#75715e"># Used to be 74M</span>
</span></span><span style="display:flex;"><span>792K    themes
</span></span></code></pre></div><p>Going from 74M to 4.1M with literally zero implication to noticable image quality is pretty great!</p>
<p>Let&rsquo;s take a look now at how long it takes to do a git pull.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Cloning into <span style="color:#e6db74">&#39;nickherrig.com&#39;</span>...
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 720, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>213/213<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>145/145<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">720</span> <span style="color:#f92672">(</span>delta 60<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">202</span> <span style="color:#f92672">(</span>delta 54<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">507</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>720/720<span style="color:#f92672">)</span>, 97.09 MiB | 9.78 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>263/263<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>git clone git@github.com:NickHerrig/nickherrig.com.git  1.29s user 2.23s system 29% cpu 11.739 total
</span></span></code></pre></div><p>Shit, it appears we went backwards here from 8.5 seconds to 11.8 seconds. I&rsquo;m assuming this is because git stores a history of changes to the repo, so all we really did here was add a bunch of smaller images to the repository. Enter git LFS.</p>
<h2 id="git-lfs">Git LFS<a hidden class="anchor" aria-hidden="true" href="#git-lfs">#</a></h2>
<p>Git Large File Storage (LFS) is a tool that helps keep your repository light by storing large files separately from your main git repo. Here is a direct quote from the documentation on how it works.</p>
<blockquote>
<p>Git LFS handles large files by storing references to the file in the repository, but not the actual file itself. To work around Git&rsquo;s architecture, Git LFS creates a pointer file which acts as a reference to the actual file (which is stored somewhere else). GitHub manages this pointer file in your repository. When you clone the repository down, GitHub uses the pointer file as a map to go and find the large file for you.</p>
</blockquote>
<p>In order to get this working for my GitHub Pages hosting, it appears that with <a href="https://github.com/orgs/community/discussions/50337">this GitHub Discussion</a> all you need to do is add a little configuration to your github actions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hugo.yaml" data-lang="hugo.yaml"><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">lfs</span>: <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><p>At this point, I made sure to initialize git LFS and track specific file types.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git lfs install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>git lfs track <span style="color:#e6db74">&#34;*.jpg&#34;</span>
</span></span><span style="display:flex;"><span>git lfs track <span style="color:#e6db74">&#34;*.jpeg&#34;</span>
</span></span><span style="display:flex;"><span>git lfs track <span style="color:#e6db74">&#34;*.png&#34;</span>
</span></span><span style="display:flex;"><span>git lfs track <span style="color:#e6db74">&#34;*.webp&#34;</span>
</span></span><span style="display:flex;"><span>git lfs track <span style="color:#e6db74">&#34;*.mp4&#34;</span>
</span></span><span style="display:flex;"><span>git lfs track <span style="color:#e6db74">&#34;*.mp3&#34;</span>
</span></span></code></pre></div><p>Since git lfs only starts tracking newly added files, we&rsquo;ll want to migrate our existing files.
We can do this by running.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git lfs migrate import --include<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;*.jpg,*.jpeg,*.png,*.webp,*.mp4,*.mp3&#34;</span> --everything
</span></span><span style="display:flex;"><span>git push --force
</span></span></code></pre></div><p>And just like that, we&rsquo;ve improved the speed of our repo clones from 11.8 seconds to 4 seconds.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Cloning into <span style="color:#e6db74">&#39;nickherrig.com&#39;</span>...
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 867, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>397/397<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>237/237<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">867</span> <span style="color:#f92672">(</span>delta 129<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">393</span> <span style="color:#f92672">(</span>delta 127<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">470</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>867/867<span style="color:#f92672">)</span>, 10.11 MiB | 10.48 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>316/316<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Filtering content: 100% <span style="color:#f92672">(</span>36/36<span style="color:#f92672">)</span>, 3.08 MiB | 1.85 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>git clone git@github.com:NickHerrig/nickherrig.com.git  0.34s user 0.50s system 20% cpu 4.076 total
</span></span></code></pre></div><p>Cheers to Saturday optimizations! ðº</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/web/">Web</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">Nick Herrig</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
